{#
This Twig template extends the Craft CMS Control Panel layout and provides the interface for the "diff. base plugin" settings page.

Template Details:
- Displays the current API key if available.
- Allows users to copy the API key, generate a new one, or access the API endpoint.
- Includes a JavaScript function for copying the API key to the clipboard.

Variables:
- `settings.apiKey`: The current API key stored in the plugin settings.

Blocks:
- `content`: Contains the main content of the settings page, including the API key management interface.

Notes:
- Ensure the `settings.apiKey` variable is properly passed to the template.
- The `copyApiKey` JavaScript function uses Craft's `Craft.cp.displayNotice` for user feedback.
#}
{% extends "_layouts/cp" %}
{% set title = "diff. base plugin" %}
{% set crumbs = [
  { label: "Settings"|t, url: url('settings') },
  { label: "diff. base plugin", url: url('diffbase') }
] %}

{% block content %}
  <div class="grid">
    <div class="item" data-colspan="2">

      {% if settings.apiKey %}
        <div class="field">
          <div class="heading">
            <label>API-Key</label>
            <div class="instructions">
              <p>Verwenden Sie diesen Key f√ºr API-Anfragen.</p>
            </div>
          </div>
          <div class="input">
            <div class="flex" style="gap: 10px; align-items: center;">
              <input type="text" value="{{ settings.apiKey }}" readonly class="text fullwidth" id="apiKeyField">

              <button type="button" class="btn secondary" onclick="copyApiKey()">
                Kopieren
              </button>

              <form method="post" action="{{ actionUrl('diffbase/cp/generate-api-key') }}" style="display: inline;">
                {{ csrfInput() }}
                {{ redirectInput('_diffbase') }}
                <button type="submit" class="btn submit">
                  {% if settings.apiKey %}
                    Neuen API-Key generieren
                  {% else %}
                  {% endif %}
                  API-Key generieren
                </button>
              </form>

              <a href="{{ siteUrl }}api/info?key={{ settings.apiKey }}" class="view-btn btn" target="_blank">
                {{ svg('@appicons/external-link.svg') }}
                API-Endpunkt aufrufen
              </a>
            </div>
          </div>
        </div>
      {% endif %}

      <hr>
    </div>
  </div>

  <script>
      /**
       * Copies the API key to the clipboard and displays a success notice.
       */
      function copyApiKey() {
          const field = document.getElementById('apiKeyField');
          field.select();
          document.execCommand('copy');

          // Display a success message using Craft's control panel notice system
          Craft.cp.displayNotice('API-Key in Zwischenablage kopiert');
      }
  </script>
{% endblock %}
